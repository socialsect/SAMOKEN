<!DOCTYPE html>
<html>
<head>
    <title>Debug API Test</title>
</head>
<body>
    <h1>Debug API Test</h1>
    <button onclick="testAPI()">Test API</button>
    <div id="result"></div>

    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing...';
            
            // Test with minimal data
            const testData = { title: "Debug Test", url: "https://www.youtube.com/watch?v=dQw4w9WgXcQ" };
            
            console.log('=== DEBUG TEST START ===');
            console.log('Test data:', testData);
            
            try {
                // Test 1: Check if endpoint is reachable
                console.log('Testing endpoint reachability...');
                const response = await fetch('https://runner-golf.wixstudio.com/runner/_functions/addVideo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                console.log('Response received');
                console.log('Status:', response.status);
                console.log('Status text:', response.statusText);
                console.log('Headers:', response.headers);
                
                // Test 2: Get response as text first
                const responseText = await response.text();
                console.log('Raw response text:', responseText);
                console.log('Response length:', responseText.length);
                
                // Test 3: Try to parse as JSON
                let parsedResponse;
                try {
                    parsedResponse = JSON.parse(responseText);
                    console.log('Parsed response:', parsedResponse);
                } catch (parseError) {
                    console.error('JSON parse error:', parseError);
                    parsedResponse = null;
                }
                
                // Test 4: Check response structure
                if (parsedResponse) {
                    console.log('Response has success property:', 'success' in parsedResponse);
                    console.log('Success value:', parsedResponse.success);
                    console.log('Error message:', parsedResponse.error);
                }
                
                // Display result
                if (response.ok && parsedResponse && parsedResponse.success) {
                    resultDiv.innerHTML = '✅ SUCCESS: ' + JSON.stringify(parsedResponse);
                } else {
                    resultDiv.innerHTML = '❌ FAILED: ' + responseText;
                }
                
            } catch (error) {
                console.error('Fetch error:', error);
                resultDiv.innerHTML = '❌ FETCH ERROR: ' + error.message;
            }
            
            console.log('=== DEBUG TEST END ===');
        }
    </script>
</body>
</html>
